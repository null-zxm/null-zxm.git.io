### 一致性哈希

#  

##### 一致性[哈希算法](https://baike.baidu.com/item/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95)在1997年由[麻省理工学院](https://baike.baidu.com/item/%E9%BA%BB%E7%9C%81%E7%90%86%E5%B7%A5%E5%AD%A6%E9%99%A2)提出(参见扩展阅读[1])，设计目标是为了解决因特网中的热点(Hot spot)问题，初衷和[CARP](https://baike.baidu.com/item/CARP)十分类似。一致性哈希修正了CARP使用的简单哈希算法带来的问题，使得DHT可以在P2P环境中真正得到应用。

#  

上面是百度百科的解释 那么到底什么是一致性哈希呢？一致性哈希算法又有什么用呢？

##### 均衡性(Balance)

平衡性是指哈希的结果能够尽可能分布到所有的缓冲中去，这样可以使得所有的缓冲空间都得到利用。很多[哈希算法](https://baike.baidu.com/item/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95)都能够满足这一条件。

说白了就是防止一个挂了 全部gg 就是鸡蛋不要放到一个篮子里

##### 单调性(Monotonicity)

单调性是指如果已经有一些内容通过哈希分派到了相应的缓冲中，又有新的[缓冲区](https://baike.baidu.com/item/%E7%BC%93%E5%86%B2%E5%8C%BA)加入到系统中，那么哈希的结果应能够保证原有已分配的内容可以被映射到新的缓冲区中去，而不会被映射到旧的缓冲集合中的其他缓冲区

##### 分散性(Spread)

在分布式环境中，终端有可能看不到所有的缓冲，而是只能看到其中的一部分。当终端希望通过哈希过程将内容映射到缓冲上时，由于不同终端所见的缓冲范围有可能不同，从而导致哈希的结果不一致，最终的结果是相同的内容被不同的终端映射到不同的[缓冲区](https://baike.baidu.com/item/%E7%BC%93%E5%86%B2%E5%8C%BA)中。这种情况显然是应该避免的，因为它导致相同内容被存储到不同缓冲中去，降低了系统存储的效率。分散性的定义就是上述情况发生的严重程度。好的[哈希算法](https://baike.baidu.com/item/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95)应能够尽量避免不一致的情况发生，也就是尽量降低分散性。

##### 负载(Load)

负载问题实际上是从另一个角度看待分散性问题。既然不同的终端可能将相同的内容映射到不同的[缓冲区](https://baike.baidu.com/item/%E7%BC%93%E5%86%B2%E5%8C%BA)中，那么对于一个特定的缓冲区而言，也可能被不同的用户映射为不同的内容。与分散性一样，这种情况也是应当避免的，因此好的[哈希算法](https://baike.baidu.com/item/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95)应能够尽量降低缓冲的负荷

#  

上面都话都比较官方化 看下面的图就能很快了解有什么用了

​	![屏幕快照 2017-07-20 下午8.52.45](/Users/mac/Desktop/屏幕快照 2017-07-20 下午8.52.45.png)

其实呢它就只是将其围绕成一个圈；图中稍微大点的圈代表的是缓存区 ；小一点的呢表示的是缓存节点，就是缓存数据。都把它们用一个hash算法算出hash值然后分布到圈上面 

* 规定：每一个缓存区管理着它和hash值比他小的缓存区之间的缓存数据

  问题来了 为什么要这样子呢？

  ​

  ![屏幕快照 2017-07-20 下午8.52.53](/Users/mac/Desktop/屏幕快照 2017-07-20 下午8.52.53.png)

  ​

如果这时候缓存区不够了 要添加的时候 计算出所添加的缓存区的hash值

将其放进其中的时候其实只影响了它后一个的缓存区这时候可以迁移 也可以

之间清空受影响的那个，让其重新拿数据

有的人就会说了；万一全部数据太集中怎么办？下面就引出了虚拟节点

* 虚拟节点其实就是假的 就是一个缓存区虚拟出来很多个 缓存区；其实这些缓存区到头来都是到同一个服务器上面的缓存区的，虚拟节点目的就是让这些数据分布的均匀

  ​