#### Bitmap算法

​														(此篇是看了梦见公众号的文章写下的知识总结)

* 问题

  正在开发的系统需要一个用户标签，这个用户标签包含着社会属性，生活习惯，消费行为等等。。。例如：

    小灰的标签：

  ​	程序员，有驾照，单身，喜欢骑行，男，90后，使用苹果手机，喜欢美剧，租房。。。

  通过小灰的标签可以实现多种的用户群体统计，例如喜欢骑行的男女比例等等，，

* 解决问题

  * 第一种

    利用Mysql设计表结构如下

    | Name | Sex  | Age  | Occupation | Phone |
    | :--: | ---- | ---- | ---------- | ----- |
    |  小灰  | 男    | 90后  | 程序员        | 苹果    |
    |  大黄  | 男    | 90后  | 程序员        | 三星    |
    |  小白  | 女    | 00后  | 学生         | 小米    |

    如果想要统计所有90后的程序员该怎么做

    使用一条SQL

    ​	SELECT	COUNT	（DISTINCT	name）as 用户数 from table where age =“90后” and Occupation=“程序员“

    看起来很简单，但是如果标签越来越多，SQL语句就会很长，并且distinct的时候性能会比较差

  * 第二种

  使用Bitmap

  ##### Bitmap：

  给定一个长度是10bit的内存空间，想要依次插入整型数据4，2，1，3 那么需要怎么做呢？

  ​

|  0   | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    | 0    |
| :--: | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
|  9   | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |

没有数据的时候表示为0，一个数据的时候表示为1，

所以插入4，2，1，3的时候就是

|  0   | 0    | 0    | 0    | 0    | 1    | 1    | 1    | 1    | 0    |
| :--: | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
|  9   | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |

这样子很容易看出存储了哪些元素

##### 那么怎么使用Bitmap来解决上面的问题呢？

* 第一： 将名字Id化

|  ID  | Name |
| :--: | ---- |
|  1   | 小灰   |
|  2   | 大黄   |
|  3   | 小白   |

|  ID  | Sex  | Age  | Occupation | Phone |
| :--: | ---- | ---- | ---------- | ----- |
|  1   | 男    | 90后  | 程序员        | 苹果    |
|  2   | 男    | 90后  | 程序员        | 三星    |
|  3   | 女    | 00后  | 学生         | 小米    |



| Sex  | Bitmap |
| :--: | ------ |
|  男   | 1，2    |
|  女   | 3      |



| Age  | Bitmap |
| :--: | ------ |
| 90后  | 1，2    |
| 00后  | 3      |

这个时候 Sex=“男”和Age=“90后”如下

|  0   | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 1    | 0    |
| :--: | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
|  9   | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |

|  0   | 0    | 0    | 0    | 0    | 0    | 0    | 1    | 1    | 0    |
| :--: | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
|  9   | 8    | 7    | 6    | 5    | 4    | 3    | 2    | 1    | 0    |

这时候如果90后的男生就是

0000000110B&00000000110B=0000000100B

所以只有ID=2 就是大黄

##### 缺点

不支持【非运算】比如查找不使用苹果手机的用户就无能为力了：

解决方案：

借助一个全局的Bitmap就可以了